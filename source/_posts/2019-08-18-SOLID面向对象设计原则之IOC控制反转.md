---
title: SOLIDé¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ä¹‹IOCæ§åˆ¶åè½¬
categories:
  - å‰ç«¯å·¥ç¨‹åŒ–ä¸æŒç»­æ„å»º
  - null
tags:
  - null
  - null
date: 2019-08-18 02:06:23
top:
---


# SOLID é¢å‘å¯¹è±¡è®¾è®¡åŸåˆ™ä¹‹ä¸€
S:å•ä¸€åŠŸèƒ½ï¼Œä¸€ä¸ªç±»åªåšä¸€ç§ç±»å‹è´£ä»»
O:å¼€é—­åŸåˆ™ï¼Œå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­
L:é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œå­ç±»å¿…é¡»èƒ½å¤Ÿæ›¿æ¢ä»–ä»¬çš„åŸºç±»
I:æ¥å£éš”ç¦»åŸåˆ™ï¼Œä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£æ¯”ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£è¦å¥½
D:ä¾èµ–åè½¬
IOCå…¨ç§°æ˜¯ æ§åˆ¶åè½¬ï¼›
DIä¾èµ–æ³¨å…¥æ˜¯å®ç°IOCçš„ä¸€ç§æ–¹å¼ï¼›

æœ¬ç¯‡æ–‡ç« ï¼Œä¸»è¦ä»‹ç»IOC

# è‡ªå·±ä»å¤´å®ç°ä¸€ä¸ªçš„IOC
## normal_demo å¸¸è§„çš„å†™æ³•
Database.jsæ–‡ä»¶
æœ‰ä¸€ä¸ªå˜é‡conStr,ä¸€ä¸ªlogæ–¹æ³•æ‰“å°è¯¥å˜é‡çš„å€¼
ä»£ç å¦‚ä¸‹
``` bash
//Database.js

class Database {
    constructor(connStr){
        this.connStr = connStr;
    }
    log(){
        console.log(this.connStr);
    }
}
module.exports = Database;
```
ç„¶åä¸»æ–‡ä»¶éœ€è¦ä½¿ç”¨ä¸Šé¢çš„Database.jsæ–‡ä»¶
æ²¡æœ‰ä½¿ç”¨IOCçš„æƒ…å†µä¸‹ï¼Œå¸¸è§„çš„æ–¹æ³•å°±æ˜¯requireæˆ–è€…import
è¿™æ ·çš„é—®é¢˜å¾ˆæ˜¾ç„¶ï¼Œå½“é¡¹ç›®å˜çš„å¤æ‚ï¼Œä¾èµ–å…³ç³»å¤šçš„æ—¶å€™ï¼ŒæŸä¸€ä¸ªä¾èµ–æ–‡ä»¶æ›´æ”¹äº†ç›®å½•æˆ–è€…ä¿®æ”¹äº†æ–‡ä»¶å
ä¼šå½±å“åˆ°å¾ˆå¤šå¾ˆå¤šçš„æ¨¡å—
ä»£ç å¦‚ä¸‹
``` bash
//index.js

const Database = require("../Database.js");
class UserService {
    constructor(){
        this.db = new Database(Math.random());
    }
    create() {
        return this.db.log();
    }
}
const userService = new UserService();
userService.create();
```

## æœ€ç®€å•çš„IOC easy_ioc_demo
æŠŠnew Databaseä¹‹åçš„å®ä¾‹ç›´æ¥ä¼ åˆ°UserServiceçš„æ„é€ å‡½æ•°ä¸­
ä»£ç å¦‚ä¸‹
``` bash
class Database {
    constructor(connStr){
        this.connStr = connStr;
    }
    log(){
        console.log(this.connStr);
    }
}
class UserService {
    constructor(db){
        //aop + di
        this.db = db;
    }
    create() {
        return this.db.log();
    }
}
const db = new Database(Math.random());
// æŠŠdbæ³¨å…¥åˆ°UserServiceçš„æ„é€ å‡½æ•°ä¸­
const userService = new UserService(db);
userService.create();
```

## æ­£è§„çš„IOCå†™æ³•
### ç¬¬ä¸€æ­¥åˆ›å»ºIOCï¼Œ lib/ioc.jsæ–‡ä»¶
åˆ›å»ºä¸€ä¸ªIOCå®¹å™¨ï¼Œè¿™é‡Œæ˜¯new ä¸€ä¸ªMap
åˆ†ä¸ºä¸¤ç§æ¨¡å¼ï¼Œæ™®é€šæ¨¡å¼å’Œå•ä¾‹æ¨¡å¼
``` bash
const { join } = require("path");
module.exports = function createIoC(rootPath) {
    return {
        container: new Map(),
        bind(key, callback) {
            this.container.set(key, { callback, singleton: false })
        },
        singleton(key, callback) {
            this.container.set(key, { callback, singleton: true })
        },
        restore(key){
            this.container.delete(key)
        },
        use(namespace) {
            const item = this.container.get(namespace);
            if (item) {
                // å•ä¾‹çš„è¯ï¼Œæ¯æ¬¡éƒ½ç”¨item.instance
                if (item.singleton && !item.instance) {
                    item.instance = item.callback();
                }
                return item.singleton ? item.instance : item.callback()
            }
            return require(join(rootPath,namespace))
        }
    }
}
```

### ç¬¬äºŒæ­¥ï¼Œioc-config.jsæ–‡ä»¶
åˆ›å»ºä¸€ä¸ªiocå®¹å™¨æŒ‚åˆ°å…¨å±€ä¸Š
å¼•å…¥éœ€è¦Database.jsæ–‡ä»¶ï¼Œæ³¨å†Œåˆ°iocå®¹å™¨é‡Œ
ç„¶åå¼•å…¥æˆ‘ä»¬çš„serviceæ¨¡å—ï¼Œä»iocå®¹å™¨ä¸­æ‹¿åˆ°éœ€è¦çš„ä¾èµ–ï¼Œæ³¨å…¥åˆ°æ„é€ å‡½æ•°ä¸­å³å¯
å…³é”®ä»£ç å¦‚ä¸‹
``` bash
const Database = require("../Database.js");
const createIoC = require("./lib/ioc");
global.ioc = createIoC(__dirname);

// å•ä¾‹æ¨¡å¼ï¼Œæ¯æ¬¡è¾“å‡ºå€¼ç›¸åŒ
ioc.singleton("Database", () => new Database(Math.random()));
// éå•ä¾‹æ¨¡å¼ï¼Œæ¯æ¬¡è¾“å‡ºå€¼ä¸åŒ
// ioc.bind("Database", () => new Database(Math.random()));

const IocService1 = require("./ioc-service1");
const IocService2 = require("./ioc-service2");

// æŠŠdatabaseæ³¨å…¥åˆ°ä¸¤ä¸ªserviceä¸­ï¼Œä¹‹åæ–‡ä»¶è·¯å¾„ä¿®æ”¹ï¼Œåªè¦åœ¨è¿™é‡Œæ”¹ä¸€ä¸‹å°±å¥½
// å› ä¸ºiocæŒ‚åˆ°å…¨å±€äº†ï¼Œå¯ä»¥åˆ°å®ƒçš„æ„é€ å‡½æ•°ä¸­use
const userService1 = new IocService1();
userService1.create();
const userService2 = new IocService2(ioc.use("Database"));
userService2.create();
```
å®Œæ•´ä»£ç ï¼Œè§æ–‡æœ«çš„ä»“åº“åœ°å€å“¦

# ç›®å‰å¸‚é¢ä¸Šæˆç†Ÿçš„å‰ç«¯IOCåº“ InversifyJS

{% asset_img ClassName 1.jpg InversifyJS %}
å®˜æ–¹ä»“åº“åœ°å€
https://github.com/inversify/InversifyJS

## ä½¿ç”¨æ­¥éª¤
ç¬¬ä¸€æ­¥ï¼šå®šä¹‰æ¥å£å’Œtypes
ç¬¬äºŒæ­¥ï¼šä½¿ç”¨@injectable å’Œ @injectè£…é¥°å™¨å£°æ˜ä¾èµ–
ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºå’Œé…ç½®ä¸€ä¸ªå®¹å™¨
ç¬¬å››æ­¥ï¼šå®Œç¾è§£å†³ä¾èµ–æ³¨å…¥é—®é¢˜
è¯¦ç»†å†…å®¹å¯ä»¥å‚é˜…å®˜æ–¹ä»“åº“å’Œå®˜æ–¹æ–‡æ¡£

## Reflect Metadata ç®€å•ä»‹ç»
æ ¸å¿ƒæ€æƒ³å’Œæˆ‘ä¸Šé¢çš„demoç±»ä¼¼ï¼Œä¸è¿‡å®ƒä½¿ç”¨åˆ°äº†Reflect Metadata
ç®€å•ä»‹ç»ä¸€ä¸‹
### åŸºç¡€
Reflect Metadata æ˜¯ ES7 çš„ä¸€ä¸ªææ¡ˆï¼Œå®ƒä¸»è¦ç”¨æ¥åœ¨å£°æ˜çš„æ—¶å€™æ·»åŠ å’Œè¯»å–å…ƒæ•°æ®ã€‚TypeScript åœ¨ 1.5+ çš„ç‰ˆæœ¬å·²ç»æ”¯æŒå®ƒï¼Œä½ åªéœ€è¦ï¼š
{% blockquote %}
* npm i reflect-metadata --saveã€‚
* åœ¨ tsconfig.json é‡Œé…ç½® emitDecoratorMetadata é€‰é¡¹ã€‚
{% endblockquote %}

Reflect Metadata çš„ API å¯ä»¥ç”¨äºç±»æˆ–è€…ç±»çš„å±æ€§ä¸Šï¼Œ
Reflect.metadata å½“ä½œ Decorator ä½¿ç”¨ï¼Œå½“ä¿®é¥°ç±»æ—¶ï¼Œåœ¨ç±»ä¸Šæ·»åŠ å…ƒæ•°æ®ï¼Œå½“ä¿®é¥°ç±»å±æ€§æ—¶ï¼Œåœ¨ç±»åŸå‹çš„å±æ€§ä¸Šæ·»åŠ å…ƒæ•°æ®

### ä½¿ç”¨åœºæ™¯
#### è·å–ç±»å‹ä¿¡æ¯
#### è‡ªå®šä¹‰ metadataKey
#### æ§åˆ¶åè½¬å’Œä¾èµ–æ³¨å…¥
åœ¨ Angular 2+ çš„ç‰ˆæœ¬ä¸­ï¼Œæ§åˆ¶åè½¬ä¸ä¾èµ–æ³¨å…¥ä¾¿æ˜¯åŸºäºæ­¤å®ç°ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªç®€å•ç‰ˆ

è¯¦ç»†å†…å®¹å¯ä»¥å‚é˜…Typescriptçš„æ–‡æ¡£ï¼›


GitHub: [GitHubé“¾æ¥](https://github.com/yllg/IOC_Demo)
æ¬¢è¿å°ä¼™ä¼´ä»¬star ğŸ’—â¤ï¸ğŸ’–~~

åŒæ—¶æ¬¢è¿å…³æ³¨æˆ‘çš„ä¸ªäººå¾®ä¿¡å…¬ä¼—å·ï¼š
{% img  /img/å…¬ä¼—å·äºŒç»´ç .jpg 300 300 æ‚¬ç¬”eç» %}